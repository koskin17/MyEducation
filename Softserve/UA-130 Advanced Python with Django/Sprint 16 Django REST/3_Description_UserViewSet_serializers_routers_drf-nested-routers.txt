UserViewSet_serializers_routers_drf-nested-routers

–û—Ç–ª–∏—á–Ω–æ! –ú—ã –ø–æ—ç—Ç–∞–ø–Ω–æ —Ä–∞–∑–±–µ—Ä—ë–º –≤—Å—ë, —á—Ç–æ –º—ã —Å–¥–µ–ª–∞–ª–∏, —á—Ç–æ–±—ã —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å CRUD —á–µ—Ä–µ–∑ Django REST Framework:

---

## üîß –ß–¢–û –ú–´ –†–ï–ê–õ–ò–ó–û–í–ê–õ–ò

* –ü–æ–ª–Ω—É—é CRUD-–ª–æ–≥–∏–∫—É –¥–ª—è –º–æ–¥–µ–ª–µ–π: `CustomUser`, `Author`, `Book`, `Order`
* –û—Å–Ω–æ–≤–Ω–æ–π API-—Ä–æ—É—Ç–∏–Ω–≥ —á–µ—Ä–µ–∑ `DefaultRouter` –∏ –≤–ª–æ–∂–µ–Ω–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã (`NestedRouter`)
* –°–µ—Ä–∏–∞–ª–∏–∑–∞—Ç–æ—Ä—ã (–ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–µ–π <-> JSON)
* –ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–ª–∞—Å—Å–æ–≤ (`ViewSet`)
* –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –º–µ—Ç–æ–¥–æ–≤ CRUD –≤ Postman

---

–¢–µ–ø–µ—Ä—å –ø–æ –ø–æ—Ä—è–¥–∫—É –∏ –æ—á–µ–Ω—å –ø–æ–¥—Ä–æ–±–Ω–æ.

---

## 1Ô∏è‚É£ –°–ï–†–ò–ê–õ–ò–ó–ê–¢–û–†–´ (serializers.py)

–°–µ—Ä–∏–∞–ª–∏–∑–∞—Ç–æ—Ä—ã –ø—Ä–µ–æ–±—Ä–∞–∑—É—é—Ç –º–æ–¥–µ–ª–∏ Django –≤ JSON-—Ñ–æ—Ä–º–∞—Ç –∏ –æ–±—Ä–∞—Ç–Ω–æ.

### –ü—Ä–∏–º–µ—Ä: `UserSerializer`

```python
class UserSerializer(serializers.ModelSerializer):
    class Meta:
        model = CustomUser
        fields = '__all__'
```

üîç –ü–æ–¥—Ä–æ–±–Ω–æ:

| –°—Ç—Ä–æ–∫–∞                        | –û–±—ä—è—Å–Ω–µ–Ω–∏–µ                                                                                           |
| ----------------------------- | ---------------------------------------------------------------------------------------------------- |
| `serializers.ModelSerializer` | –ù–∞—Å–ª–µ–¥—É–µ–º—Å—è –æ—Ç DRF-–∫–ª–∞—Å—Å–∞, –∫–æ—Ç–æ—Ä—ã–π —Å–∞–º —É–º–µ–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å—Ç—Ä–æ–∏—Ç—å –ø–æ–ª—è –∏–∑ –º–æ–¥–µ–ª–∏.                   |
| `Meta`                        | –í–ª–æ–∂–µ–Ω–Ω—ã–π –∫–ª–∞—Å—Å —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –¥–ª—è —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ç–æ—Ä–∞.                                                     |
| `model = CustomUser`          | –£–∫–∞–∑—ã–≤–∞–µ–º, –∫ –∫–∞–∫–æ–π –º–æ–¥–µ–ª–∏ –æ—Ç–Ω–æ—Å–∏—Ç—Å—è —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ç–æ—Ä.                                                    |
| `fields = '__all__'`          | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–∫–ª—é—á–∞–µ–º –≤—Å–µ –ø–æ–ª—è –º–æ–¥–µ–ª–∏ –≤ —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—é (–º–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ: `['id', 'email']`). |

–ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ —Ä–∞–±–æ—Ç–∞—é—Ç `AuthorSerializer`, `BookSerializer`, `OrderSerializer`.

---

## 2Ô∏è‚É£ ViewSet'—ã (views.py)

`ViewSet` ‚Äî —ç—Ç–æ –∫–ª–∞—Å—Å, –∫–æ—Ç–æ—Ä—ã–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –≤–µ—Å—å CRUD –Ω–∞ –æ—Å–Ω–æ–≤–µ –º–æ–¥–µ–ª–∏ –∏ —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ç–æ—Ä–∞.

### –ü—Ä–∏–º–µ—Ä: `UserViewSet`

```python
class UserViewSet(viewsets.ModelViewSet):
    queryset = CustomUser.objects.all()
    serializer_class = UserSerializer
```

üîç –ü–æ–¥—Ä–æ–±–Ω–æ:

| –°—Ç—Ä–æ–∫–∞                                | –û–±—ä—è—Å–Ω–µ–Ω–∏–µ                                                                                                     |
| ------------------------------------- | -------------------------------------------------------------------------------------------------------------- |
| `viewsets.ModelViewSet`               | –†–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π –∫–ª–∞—Å—Å –æ—Ç DRF, –∫–æ—Ç–æ—Ä—ã–π –≤–∫–ª—é—á–∞–µ—Ç: `.list()`, `.retrieve()`, `.create()`, `.update()`, `.destroy()`. |
| `queryset = CustomUser.objects.all()` | –£–∫–∞–∑—ã–≤–∞–µ–º, –∫–∞–∫–∏–µ –æ–±—ä–µ–∫—Ç—ã –±—É–¥—É—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å—Å—è —ç—Ç–∏–º ViewSet.                                                    |
| `serializer_class = UserSerializer`   | –ö–∞–∫ —Å–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞—Ç—å/–¥–µ—Å–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞—Ç—å –æ–±—ä–µ–∫—Ç—ã.                                                                     |

–ò–¥–µ–Ω—Ç–∏—á–Ω–æ —É—Å—Ç—Ä–æ–µ–Ω—ã `AuthorViewSet`, `BookViewSet`, `OrderViewSet` (—Å –Ω—é–∞–Ω—Å–æ–º ‚Äî –Ω–∏–∂–µ —Ä–∞–∑–±–µ—Ä—ë–º –≤–ª–æ–∂–µ–Ω–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã).

---

## 3Ô∏è‚É£ –í–ª–æ–∂–µ–Ω–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã (Nested Routers)

DRF —Å–∞–º –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤–ª–æ–∂–µ–Ω–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã (user/1/order/5), –Ω–æ —Å –ø–æ–º–æ—â—å—é `drf-nested-routers` –º—ã —ç—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–ª–∏.

### –ü—Ä–∏–º–µ—Ä:

```python
router = DefaultRouter()
router.register(r'user', UserViewSet, basename='user')
router.register(r'order', OrderViewSet, basename='order')

user_router = NestedDefaultRouter(router, r'user', lookup='user')
user_router.register(r'order', OrderViewSet, basename='user-orders')
```

üîç –ü–æ–¥—Ä–æ–±–Ω–æ:

| –°—Ç—Ä–æ–∫–∞                                | –û–±—ä—è—Å–Ω–µ–Ω–∏–µ                                                                              |
| ------------------------------------- | --------------------------------------------------------------------------------------- |
| `DefaultRouter()`                     | –û—Å–Ω–æ–≤–Ω–æ–π –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä. –°–∞–º —Å–æ–∑–¥–∞—ë—Ç –ø—É—Ç–∏ –¥–ª—è `user/`, `order/` –∏ —Ç.–¥.                   |
| `register()`                          | –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º ViewSet: `user/ -> UserViewSet`, `order/ -> OrderViewSet`                  |
| `NestedDefaultRouter()`               | –°–æ–∑–¥–∞—ë—Ç –≤–ª–æ–∂–µ–Ω–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã. `lookup='user'` –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ `user_id`. |
| `user_router.register(r'order', ...)` | –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –≤–ª–æ–∂–µ–Ω–Ω—ã–π –º–∞—Ä—à—Ä—É—Ç `user/{user_id}/order/`                                  |

–¢–µ–ø–µ—Ä—å `http://127.0.0.1:8000/api/v1/user/1/order/5/` —Ä–∞–±–æ—Ç–∞–µ—Ç!

---

## 4Ô∏è‚É£ –†–æ—É—Ç–∏–Ω–≥ (urls.py)

```python
urlpatterns = [
    path('admin/', admin.site.urls),
    path('api/v1/', include(router.urls)),
    path('api/v1/', include(user_router.urls)),
]
```

üîç –û–±—ä—è—Å–Ω–µ–Ω–∏–µ:

* –ü–æ–¥–∫–ª—é—á–∞–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π `router` (`user/`, `order/`, `book/`, `author/`)
* –ü–æ–¥–∫–ª—é—á–∞–µ–º –≤–ª–æ–∂–µ–Ω–Ω—ã–µ –ø—É—Ç–∏ `user/{user_id}/order/`

---

## 5Ô∏è‚É£ –ú–ï–¢–û–î–´ CRUD –≤ Postman

| CRUD   | HTTP        | –ü—Ä–∏–º–µ—Ä –≤ Postman  | –û–ø–∏—Å–∞–Ω–∏–µ                                                  |
| ------ | ----------- | ----------------- | --------------------------------------------------------- |
| Create | POST        | `/api/v1/user/`   | –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è                               |
| Read   | GET         | `/api/v1/user/5/` | –ü–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –æ–¥–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è                       |
| Update | PUT / PATCH | `/api/v1/user/5/` | –û–±–Ω–æ–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (PUT ‚Äî –ø–æ–ª–Ω–æ—Å—Ç—å—é, PATCH ‚Äî —á–∞—Å—Ç–∏—á–Ω–æ) |
| Delete | DELETE      | `/api/v1/user/5/` | –£–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è                                      |

---

–ï—Å–ª–∏ —Ç—ã —Ö–æ—á–µ—à—å, —è –º–æ–≥—É:

* üîÑ –†–∞–∑–æ–±—Ä–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ `OrderViewSet`, `AuthorViewSet`, `BookViewSet` —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏
* üîß –ü–æ–∫–∞–∑–∞—Ç—å, –∫–∞–∫ —Ä–∞—Å—à–∏—Ä–∏—Ç—å `create`, `update`, —á—Ç–æ–±—ã –≤—ã–ø–æ–ª–Ω—è—Ç—å –∫–∞—Å—Ç–æ–º–Ω—É—é –ª–æ–≥–∏–∫—É
* üí° –û–±—ä—è—Å–Ω–∏—Ç—å, –∫–∞–∫ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é –∑–∞–∫–∞–∑–æ–≤ –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –∏ –∫–Ω–∏–≥–µ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

